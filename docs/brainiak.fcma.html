

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>brainiak.fcma package &mdash; brainiak 0.11 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="brainiak.funcalign package" href="brainiak.funcalign.html" />
    <link rel="prev" title="brainiak.factoranalysis package" href="brainiak.factoranalysis.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> brainiak
          

          
          </a>

          
            
            
              <div class="version">
                0.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">brainiak</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="api.html">API</a> &raquo;</li>
        
          <li><a href="brainiak.html">brainiak package</a> &raquo;</li>
        
      <li>brainiak.fcma package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/brainiak.fcma.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-brainiak.fcma">
<span id="brainiak-fcma-package"></span><h1>brainiak.fcma package<a class="headerlink" href="#module-brainiak.fcma" title="Permalink to this headline">¶</a></h1>
<p>Full correlation matrix analysis</p>
<p>The implementation is based on the work in <a class="reference internal" href="#wang2015-1" id="id1"><span>[Wang2015-1]</span></a> and <a class="reference internal" href="#wang2015-2" id="id2"><span>[Wang2015-2]</span></a>.</p>
<dl class="citation">
<dt class="label" id="wang2015-1"><span class="brackets"><a class="fn-backref" href="#id1">Wang2015-1</a></span></dt>
<dd><p>Full correlation matrix analysis (FCMA): An unbiased method for
task-related functional connectivity”,
Yida Wang, Jonathan D Cohen, Kai Li, Nicholas B Turk-Browne.
Journal of Neuroscience Methods, 2015.</p>
</dd>
<dt class="label" id="wang2015-2"><span class="brackets"><a class="fn-backref" href="#id2">Wang2015-2</a></span></dt>
<dd><p>“Full correlation matrix analysis of fMRI data on Intel® Xeon
Phi™ coprocessors”,
Yida Wang, Michael J. Anderson, Jonathan D. Cohen, Alexander Heinecke,
Kai Li, Nadathur Satish, Narayanan Sundaram, Nicholas B. Turk-Browne,
Theodore L. Willke.
In Proceedings of the International Conference for
High Performance Computing,
Networking, Storage and Analysis. 2015.</p>
</dd>
</dl>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-brainiak.fcma.classifier">
<span id="brainiak-fcma-classifier-module"></span><h2>brainiak.fcma.classifier module<a class="headerlink" href="#module-brainiak.fcma.classifier" title="Permalink to this headline">¶</a></h2>
<p>Full Correlation Matrix Analysis (FCMA)</p>
<p>Correlation-based training and prediction</p>
<dl class="py class">
<dt id="brainiak.fcma.classifier.Classifier">
<em class="property">class </em><code class="sig-prename descclassname">brainiak.fcma.classifier.</code><code class="sig-name descname">Classifier</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clf</span></em>, <em class="sig-param"><span class="n">num_processed_voxels</span><span class="o">=</span><span class="default_value">2000</span></em>, <em class="sig-param"><span class="n">epochs_per_subj</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.classifier.Classifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.BaseEstimator</span></code></p>
<p>Correlation-based classification component of FCMA</p>
<p>The classifier first computes correlation of the input data,
and normalizes them if needed, then uses the given classifier
to train and/or predict the correlation data.
NOTE: if the classifier is sklearn.svm.SVC with precomputed kernel,
the test data may be provided in the fit method to compute
the kernel matrix together with the training data to save the memory usage,
but the test data will NEVER be seen in the model training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>clf</strong> (<em>class</em>) – The classifier used, normally a classifier class of sklearn</p></li>
<li><p><strong>num_processed_voxels</strong> (<em>int</em><em>, </em><em>default 2000</em>) – Used for SVM with precomputed kernel,
every time it only computes correlation between num_process_voxels and
the whole mask to aggregate the kernel matrices.
This is to save the memory
so as to handle correlations at a larger scale.</p></li>
<li><p><strong>epochs_per_subj</strong> (<em>int</em><em>, </em><em>default 0</em>) – The number of epochs of each subject
within-subject normalization will be performed during
classifier training if epochs_per_subj is specified
default 0 means no within-subject normalization</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.training_data_">
<code class="sig-name descname">training_data_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.training_data_" title="Permalink to this definition">¶</a></dt>
<dd><p>training_data_ is None except clf is SVM.SVC with precomputed kernel,
in which case training data is needed to compute
the similarity vector for each sample to be classified.
However, if the test samples are also provided during the fit,
the similarity vectors can be precomputed too
and then training_data_ is None</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>2D numpy array in shape [num_samples, num_features]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.test_raw_data_">
<code class="sig-name descname">test_raw_data_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.test_raw_data_" title="Permalink to this definition">¶</a></dt>
<dd><p>default None
test_raw_data_ is set after a prediction is called,
if the new input data equals test_raw_data_,
test_data_ can be reused</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>a list of 2D array in shape [num_TRs, num_voxels]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.test_data_">
<code class="sig-name descname">test_data_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.test_data_" title="Permalink to this definition">¶</a></dt>
<dd><p>default None
test_data_ is set after a prediction is called,
so that the test data does not need to be regenerated in the
subsequent operations, e.g. getting decision values of the prediction.
test_data_ may also be set in the fit method
if sklearn.svm.SVC with precomputed kernel
and the test samples are known.
NOTE: the test samples will never be used to fit the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>2D numpy array in shape [num_samples, num_features]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.num_voxels_">
<code class="sig-name descname">num_voxels_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.num_voxels_" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of voxels of the first brain region used in the classifier.
The first brain region is always large. When training, this region may
be divided to compute the correlation portion by portion.
The brain regions are defined by the applied mask, e.g. the top voxels
selected by FCMA voxel selection</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.num_features_">
<code class="sig-name descname">num_features_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.num_features_" title="Permalink to this definition">¶</a></dt>
<dd><p>The dimension of correlation data, normally is the product of
the number of voxels of brain region 1 and
the number of voxels of brain region 2.
num_features_ must be consistent in both training and classification</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.num_samples_">
<code class="sig-name descname">num_samples_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.num_samples_" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of samples</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.classifier.Classifier.num_digits_">
<code class="sig-name descname">num_digits_</code><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.num_digits_" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of digits of the first value of the kernel matrix,
for normalizing the kernel values accordingly</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="brainiak.fcma.classifier.Classifier.decision_function">
<code class="sig-name descname">decision_function</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.decision_function" title="Permalink to this definition">¶</a></dt>
<dd><p>Output the decision value of the prediction.</p>
<p>if X is not equal to self.test_raw_data_, i.e. predict is not called,
first generate the test_data
after getting the test_data, get the decision value via self.clf.
if X is None, test_data_ is ready to be used</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>X</strong> (<em>Optional</em><em>[</em><em>list of tuple</em><em> (</em><em>data1</em><em>, </em><em>data2</em><em>)</em><em>]</em>) – data1 and data2 are numpy array in shape [num_TRs, num_voxels]
to be computed for correlation.
default None, meaning that the data to be predicted
have been processed in the fit method.
Otherwise, X contains the activity data filtered by ROIs
and prepared for correlation computation.
len(X) is the number of test samples.
if len(X) &gt; 1: normalization is done on all test samples.
Within list, all data1s must have the same num_voxels value,
all data2s must have the same num_voxels value.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>confidence</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>the predictions confidence values of X, in shape [len(X),]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="brainiak.fcma.classifier.Classifier.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">num_training_samples</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Use correlation data to train a model.</p>
<p>First compute the correlation of the input data,
and then normalize within subject
if more than one sample in one subject,
and then fit to a model defined by self.clf.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>list of tuple</em><em> (</em><em>data1</em><em>, </em><em>data2</em><em>)</em>) – data1 and data2 are numpy array in shape [num_TRs, num_voxels]
to be computed for correlation.
They contain the activity data filtered by ROIs
and prepared for correlation computation.
Within list, all data1s must have the same num_voxels value,
all data2s must have the same num_voxels value.</p></li>
<li><p><strong>y</strong> (<em>1D numpy array</em>) – labels, len(X) equals len(y)</p></li>
<li><p><strong>num_training_samples</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – The number of samples used in the training.
Set it to construct the kernel matrix
portion by portion so the similarity vectors of the
test data have to be computed here.
Only set num_training_samples when sklearn.svm.SVC with
precomputed kernel is used.
If it is set, only those samples will be used to fit the model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>self.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#brainiak.fcma.classifier.Classifier" title="brainiak.fcma.classifier.Classifier">Classifier</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="brainiak.fcma.classifier.Classifier.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a trained model to predict correlation data.</p>
<p>first compute the correlation of the input data,
and then normalize across all samples in the list
if there are more than one sample,
and then predict via self.clf.
If X is None, use the similarity vectors produced in fit
to predict</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>X</strong> (<em>Optional</em><em>[</em><em>list of tuple</em><em> (</em><em>data1</em><em>, </em><em>data2</em><em>)</em><em>]</em>) – data1 and data2 are numpy array in shape [num_TRs, num_voxels]
to be computed for correlation.
default None, meaning that the data to be predicted
have been processed in the fit method.
Otherwise, X contains the activity data filtered by ROIs
and prepared for correlation computation.
len(X) is the number of test samples.
if len(X) &gt; 1: normalization is done on all test samples.
Within list, all data1s must have the same num_voxels value,
all data2s must have the same num_voxels value.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>y_pred</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>the predicted label of X, in shape [len(X),]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="brainiak.fcma.classifier.Classifier.score">
<code class="sig-name descname">score</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">sample_weight</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.classifier.Classifier.score" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the mean accuracy on the given test data and labels.</p>
<p>NOTE: In the condition of sklearn.svm.SVC with precomputed kernel
when the kernel matrix is computed portion by portion, the function
will ignore the first input argument X.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>list of tuple</em><em> (</em><em>data1</em><em>, </em><em>data2</em><em>)</em>) – data1 and data2 are numpy array in shape [num_TRs, num_voxels]
to be computed for correlation.
They are test samples.
They contain the activity data filtered by ROIs
and prepared for correlation computation.
Within list, all data1s must have the same num_voxels value,
all data2s must have the same num_voxels value.
len(X) is the number of test samples.</p></li>
<li><p><strong>y</strong> (<em>1D numpy array</em>) – labels, len(X) equals len(y), which is num_samples</p></li>
<li><p><strong>sample_weight</strong> (<em>1D array in shape</em><em> [</em><em>num_samples</em><em>]</em><em>, </em><em>optional</em>) – Sample weights.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>score</strong> – Mean accuracy of self.predict(X) wrt. y.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-brainiak.fcma.fcma_extension">
<span id="brainiak-fcma-fcma-extension-module"></span><h2>brainiak.fcma.fcma_extension module<a class="headerlink" href="#module-brainiak.fcma.fcma_extension" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="brainiak.fcma.fcma_extension.normalization">
<code class="sig-prename descclassname">brainiak.fcma.fcma_extension.</code><code class="sig-name descname">normalization</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">arg0</span><span class="p">:</span> <span class="n">numpy.ndarray<span class="p">[</span>float32<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">arg1</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#brainiak.fcma.fcma_extension.normalization" title="Permalink to this definition">¶</a></dt>
<dd><p>Within-subejct correlation normalization</p>
</dd></dl>

</div>
<div class="section" id="module-brainiak.fcma.mvpa_voxelselector">
<span id="brainiak-fcma-mvpa-voxelselector-module"></span><h2>brainiak.fcma.mvpa_voxelselector module<a class="headerlink" href="#module-brainiak.fcma.mvpa_voxelselector" title="Permalink to this headline">¶</a></h2>
<p>Full Correlation Matrix Analysis (FCMA)</p>
<p>Activity-based voxel selection</p>
<dl class="py class">
<dt id="brainiak.fcma.mvpa_voxelselector.MVPAVoxelSelector">
<em class="property">class </em><code class="sig-prename descclassname">brainiak.fcma.mvpa_voxelselector.</code><code class="sig-name descname">MVPAVoxelSelector</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">mask</span></em>, <em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">num_folds</span></em>, <em class="sig-param"><span class="n">sl</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.mvpa_voxelselector.MVPAVoxelSelector" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Activity-based voxel selection component of FCMA</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>4D array in shape</em><em> [</em><em>brain 3D + epoch</em><em>]</em>) – contains the averaged and normalized brain data epoch by epoch.
It is generated by .io.prepare_searchlight_mvpa_data</p></li>
<li><p><strong>mask</strong> (<em>3D array</em>) – </p></li>
<li><p><strong>labels</strong> (<em>1D array</em>) – contains the labels of the epochs.
It is generated by .io.prepare_searchlight_mvpa_data</p></li>
<li><p><strong>num_folds</strong> (<em>int</em>) – the number of folds to be conducted in the cross validation</p></li>
<li><p><strong>sl</strong> (<a class="reference internal" href="brainiak.searchlight.html#brainiak.searchlight.searchlight.Searchlight" title="brainiak.searchlight.searchlight.Searchlight"><em>Searchlight</em></a>) – the distributed Searchlight object</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="brainiak.fcma.mvpa_voxelselector.MVPAVoxelSelector.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clf</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.mvpa_voxelselector.MVPAVoxelSelector.run" title="Permalink to this definition">¶</a></dt>
<dd><p>run activity-based voxel selection</p>
<p>Sort the voxels based on the cross-validation accuracy
of their activity vectors within the searchlight</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>clf</strong> (<em>classification function</em>) – the classifier to be used in cross validation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_volume</strong> (<em>3D array of accuracy numbers</em>) – contains the voxelwise accuracy numbers obtained via Searchlight</p></li>
<li><p><strong>results</strong> (<em>list of tuple (voxel_id, accuracy)</em>) – the accuracy numbers of all voxels, in accuracy descending order
the length of array equals the number of voxels</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-brainiak.fcma.preprocessing">
<span id="brainiak-fcma-preprocessing-module"></span><h2>brainiak.fcma.preprocessing module<a class="headerlink" href="#module-brainiak.fcma.preprocessing" title="Permalink to this headline">¶</a></h2>
<p>FCMA preprocessing.</p>
<dl class="py class">
<dt id="brainiak.fcma.preprocessing.RandomType">
<em class="property">class </em><code class="sig-prename descclassname">brainiak.fcma.preprocessing.</code><code class="sig-name descname">RandomType</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.preprocessing.RandomType" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></p>
<p>Define the random types as enumeration</p>
<p>NORANDOM means do not randomize the image data;
REPRODUCIBLE means randomize the image data with a fixed seed so that the
permutation holds between different runs;
UNREPRODUCIBLE means truly randomize the image data which returns
different results in different runs.</p>
<dl class="py attribute">
<dt id="brainiak.fcma.preprocessing.RandomType.NORANDOM">
<code class="sig-name descname">NORANDOM</code><em class="property"> = 0</em><a class="headerlink" href="#brainiak.fcma.preprocessing.RandomType.NORANDOM" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.preprocessing.RandomType.REPRODUCIBLE">
<code class="sig-name descname">REPRODUCIBLE</code><em class="property"> = 1</em><a class="headerlink" href="#brainiak.fcma.preprocessing.RandomType.REPRODUCIBLE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="brainiak.fcma.preprocessing.RandomType.UNREPRODUCIBLE">
<code class="sig-name descname">UNREPRODUCIBLE</code><em class="property"> = 2</em><a class="headerlink" href="#brainiak.fcma.preprocessing.RandomType.UNREPRODUCIBLE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="brainiak.fcma.preprocessing.generate_epochs_info">
<code class="sig-prename descclassname">brainiak.fcma.preprocessing.</code><code class="sig-name descname">generate_epochs_info</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">epoch_list</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.preprocessing.generate_epochs_info" title="Permalink to this definition">¶</a></dt>
<dd><p>use epoch_list to generate epoch_info defined below</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>epoch_list</strong> (<em>list of 3D</em><em> (</em><em>binary</em><em>) </em><em>array in shape</em><em> [</em><em>condition</em><em>, </em><em>nEpochs</em><em>, </em><em>nTRs</em><em>]</em>) – Contains specification of epochs and conditions, assuming
1. all subjects have the same number of epochs;
2. len(epoch_list) equals the number of subjects;
3. an epoch is always a continuous time course.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>epoch_info</strong> – label is the condition labels of the epochs;
sid is the subject id, corresponding to the index of raw_data;
start is the start TR of an epoch (inclusive);
end is the end TR of an epoch(exclusive).
Assuming len(labels) labels equals the number of epochs and
the epochs of the same sid are adjacent in epoch_info</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of tuple (label, sid, start, end)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="brainiak.fcma.preprocessing.prepare_fcma_data">
<code class="sig-prename descclassname">brainiak.fcma.preprocessing.</code><code class="sig-name descname">prepare_fcma_data</code><span class="sig-paren">(</span><em class="sig-param">images</em>, <em class="sig-param">conditions</em>, <em class="sig-param">mask1</em>, <em class="sig-param">mask2=None</em>, <em class="sig-param">random=&lt;RandomType.NORANDOM: 0&gt;</em>, <em class="sig-param">comm=&lt;mpi4py.MPI.Intracomm object&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.preprocessing.prepare_fcma_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare data for correlation-based computation and analysis.</p>
<p>Generate epochs of interests, then broadcast to all workers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<em>Iterable</em><em>[</em><em>SpatialImage</em><em>]</em>) – Data.</p></li>
<li><p><strong>conditions</strong> (<em>List</em><em>[</em><em>UniqueLabelConditionSpec</em><em>]</em>) – Condition specification.</p></li>
<li><p><strong>mask1</strong> (<em>np.ndarray</em>) – Mask to apply to each image.</p></li>
<li><p><strong>mask2</strong> (<em>Optional</em><em>[</em><em>np.ndarray</em><em>]</em>) – Mask to apply to each image.
If it is not specified, the method will assign None to the returning
variable raw_data2 and the self-correlation on raw_data1 will be
computed</p></li>
<li><p><strong>random</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#brainiak.fcma.preprocessing.RandomType" title="brainiak.fcma.preprocessing.RandomType"><em>RandomType</em></a><em>]</em>) – Randomize the image data within subject or not.</p></li>
<li><p><strong>comm</strong> (<em>MPI.Comm</em>) – MPI communicator to use for MPI operations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>raw_data1</strong> (<em>list of 2D array in shape [epoch length, nVoxels]</em>) – the data organized in epochs, specified by the first mask.
len(raw_data) equals the number of epochs</p></li>
<li><p><strong>raw_data2</strong> (<em>Optional, list of 2D array in shape [epoch length, nVoxels]</em>) – the data organized in epochs, specified by the second mask if any.
len(raw_data2) equals the number of epochs</p></li>
<li><p><strong>labels</strong> (<em>list of 1D array</em>) – the condition labels of the epochs
len(labels) labels equals the number of epochs</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="brainiak.fcma.preprocessing.prepare_mvpa_data">
<code class="sig-prename descclassname">brainiak.fcma.preprocessing.</code><code class="sig-name descname">prepare_mvpa_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">images</span></em>, <em class="sig-param"><span class="n">conditions</span></em>, <em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.preprocessing.prepare_mvpa_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare data for activity-based model training and prediction.</p>
<p>Average the activity within epochs and z-scoring within subject.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<em>Iterable</em><em>[</em><em>SpatialImage</em><em>]</em>) – Data.</p></li>
<li><p><strong>conditions</strong> (<em>List</em><em>[</em><em>UniqueLabelConditionSpec</em><em>]</em>) – Condition specification.</p></li>
<li><p><strong>mask</strong> (<em>np.ndarray</em>) – Mask to apply to each image.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>processed_data</strong> (<em>2D array in shape [num_voxels, num_epochs]</em>) – averaged epoch by epoch processed data</p></li>
<li><p><strong>labels</strong> (<em>1D array</em>) – contains labels of the data</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="brainiak.fcma.preprocessing.prepare_searchlight_mvpa_data">
<code class="sig-prename descclassname">brainiak.fcma.preprocessing.</code><code class="sig-name descname">prepare_searchlight_mvpa_data</code><span class="sig-paren">(</span><em class="sig-param">images</em>, <em class="sig-param">conditions</em>, <em class="sig-param">data_type=&lt;class 'numpy.float32'&gt;</em>, <em class="sig-param">random=&lt;RandomType.NORANDOM: 0&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.preprocessing.prepare_searchlight_mvpa_data" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain the data for activity-based voxel selection using Searchlight</p>
<p>Average the activity within epochs and z-scoring within subject,
while maintaining the 3D brain structure. In order to save memory,
the data is processed subject by subject instead of reading all in before
processing. Assuming all subjects live in the identical cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<em>Iterable</em><em>[</em><em>SpatialImage</em><em>]</em>) – Data.</p></li>
<li><p><strong>conditions</strong> (<em>List</em><em>[</em><em>UniqueLabelConditionSpec</em><em>]</em>) – Condition specification.</p></li>
<li><p><strong>data_type</strong> – Type to cast image to.</p></li>
<li><p><strong>random</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#brainiak.fcma.preprocessing.RandomType" title="brainiak.fcma.preprocessing.RandomType"><em>RandomType</em></a><em>]</em>) – Randomize the image data within subject or not.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>processed_data</strong> (<em>4D array in shape [brain 3D + epoch]</em>) – averaged epoch by epoch processed data</p></li>
<li><p><strong>labels</strong> (<em>1D array</em>) – contains labels of the data</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-brainiak.fcma.util">
<span id="brainiak-fcma-util-module"></span><h2>brainiak.fcma.util module<a class="headerlink" href="#module-brainiak.fcma.util" title="Permalink to this headline">¶</a></h2>
<p>Full Correlation Matrix Analysis (FCMA)</p>
<p>Correlation related high performance routines</p>
<dl class="py function">
<dt id="brainiak.fcma.util.compute_correlation">
<code class="sig-prename descclassname">brainiak.fcma.util.</code><code class="sig-name descname">compute_correlation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">matrix1</span></em>, <em class="sig-param"><span class="n">matrix2</span></em>, <em class="sig-param"><span class="n">return_nans</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.util.compute_correlation" title="Permalink to this definition">¶</a></dt>
<dd><p>compute correlation between two sets of variables</p>
<p>Correlate the rows of matrix1 with the rows of matrix2.
If matrix1 == matrix2, it is auto-correlation computation
resulting in a symmetric correlation matrix.
The number of columns MUST agree between set1 and set2.
The correlation being computed here is
the Pearson’s correlation coefficient, which can be expressed as</p>
<div class="math notranslate nohighlight">
\[corr(X, Y) = \frac{cov(X, Y)}{\sigma_X\sigma_Y}\]</div>
<p>where cov(X, Y) is the covariance of variable X and Y, and</p>
<div class="math notranslate nohighlight">
\[\sigma_X\]</div>
<p>is the standard deviation of variable X</p>
<p>Reducing the correlation computation to matrix multiplication
and using BLAS GEMM API wrapped by Scipy can speedup the numpy built-in
correlation computation (numpy.corrcoef) by one order of magnitude</p>
<div class="math notranslate nohighlight">
\[\begin{split}corr(X, Y)
&amp;= \frac{\sum\limits_{i=1}^n (x_i-\bar{x})(y_i-\bar{y})}{(n-1)
\sqrt{\frac{\sum\limits_{j=1}^n x_j^2-n\bar{x}}{n-1}}
\sqrt{\frac{\sum\limits_{j=1}^{n} y_j^2-n\bar{y}}{n-1}}}\\
&amp;= \sum\limits_{i=1}^n(\frac{(x_i-\bar{x})}
{\sqrt{\sum\limits_{j=1}^n x_j^2-n\bar{x}}}
\frac{(y_i-\bar{y})}{\sqrt{\sum\limits_{j=1}^n y_j^2-n\bar{y}}})\end{split}\]</div>
<p>By default (return_nans=False), returns zeros for vectors with NaNs.
If return_nans=True, convert zeros to NaNs (np.nan) in output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matrix1</strong> (<em>2D array in shape</em><em> [</em><em>r1</em><em>, </em><em>c</em><em>]</em>) – MUST be continuous and row-major</p></li>
<li><p><strong>matrix2</strong> (<em>2D array in shape</em><em> [</em><em>r2</em><em>, </em><em>c</em><em>]</em>) – MUST be continuous and row-major</p></li>
<li><p><strong>return_nans</strong> (<em>bool</em><em>, </em><em>default:False</em>) – If False, return zeros for NaNs; if True, return NaNs</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>corr_data</strong> – continuous and row-major in np.float32</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>2D array in shape [r1, r2]</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-brainiak.fcma.voxelselector">
<span id="brainiak-fcma-voxelselector-module"></span><h2>brainiak.fcma.voxelselector module<a class="headerlink" href="#module-brainiak.fcma.voxelselector" title="Permalink to this headline">¶</a></h2>
<p>Full Correlation Matrix Analysis (FCMA)</p>
<p>Correlation-based voxel selection</p>
<dl class="py class">
<dt id="brainiak.fcma.voxelselector.VoxelSelector">
<em class="property">class </em><code class="sig-prename descclassname">brainiak.fcma.voxelselector.</code><code class="sig-name descname">VoxelSelector</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">epochs_per_subj</span></em>, <em class="sig-param"><span class="n">num_folds</span></em>, <em class="sig-param"><span class="n">raw_data</span></em>, <em class="sig-param"><span class="n">raw_data2</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">voxel_unit</span><span class="o">=</span><span class="default_value">64</span></em>, <em class="sig-param"><span class="n">process_num</span><span class="o">=</span><span class="default_value">4</span></em>, <em class="sig-param"><span class="n">master_rank</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.voxelselector.VoxelSelector" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Correlation-based voxel selection component of FCMA.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> (<em>list of 1D array</em>) – the condition labels of the epochs
len(labels) labels equals the number of epochs</p></li>
<li><p><strong>epochs_per_subj</strong> (<em>int</em>) – The number of epochs of each subject</p></li>
<li><p><strong>num_folds</strong> (<em>int</em>) – The number of folds to be conducted in the cross validation</p></li>
<li><p><strong>raw_data</strong> (<em>list of 2D array in shape</em><em> [</em><em>epoch length</em><em>, </em><em>nVoxels</em><em>]</em>) – <dl class="simple">
<dt>Assumption: 1. all activity data contains the same number of voxels</dt><dd><ol class="arabic simple" start="2">
<li><p>the activity data has been z-scored,
ready to compute correlation as matrix multiplication</p></li>
<li><p>all subjects have the same number of epochs</p></li>
<li><p>epochs belonging to the same subject are adjacent
in the list</p></li>
<li><p>if MPI jobs are running on multiple nodes, the path
used must be on a filesystem shared by all nodes</p></li>
</ol>
</dd>
</dl>
</p></li>
<li><p><strong>raw_data2</strong> (<em>Optional</em><em>, </em><em>list of 2D array in shape</em><em> [</em><em>epoch length</em><em>, </em><em>nVoxels</em><em>]</em>) – raw_data2 shares the data structure of the assumptions of raw_data
If raw_data2 is None, the correlation will be computed as
raw_data by raw_data.
If raw_data2 is specified, len(raw_data) MUST equal len(raw_data2),
the correlation will be computed as raw_data by raw_data2.</p></li>
<li><p><strong>voxel_unit</strong> (<em>int</em><em>, </em><em>default 64</em>) – The number of voxels assigned to a worker each time</p></li>
<li><p><strong>process_num</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – The maximum number of processes used in cross validation.
If None, the number of processes will equal
the number of available hardware threads, considering cpusets
restrictions.
If 0, cross validation will not use python multiprocessing.</p></li>
<li><p><strong>master_rank</strong> (<em>int</em><em>, </em><em>default 0</em>) – The process which serves as the master</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="brainiak.fcma.voxelselector.VoxelSelector.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clf</span></em><span class="sig-paren">)</span><a class="headerlink" href="#brainiak.fcma.voxelselector.VoxelSelector.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run correlation-based voxel selection in master-worker model.</p>
<p>Sort the voxels based on the cross-validation accuracy
of their correlation vectors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>clf</strong> (<em>classification function</em>) – the classifier to be used in cross validation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>results</strong> – the accuracy numbers of all voxels, in accuracy descending order
the length of array equals the number of voxels</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list of tuple (voxel_id, accuracy)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="brainiak.funcalign.html" class="btn btn-neutral float-right" title="brainiak.funcalign package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="brainiak.factoranalysis.html" class="btn btn-neutral float-left" title="brainiak.factoranalysis package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016, Princeton Neuroscience Institute and Intel Corporation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>